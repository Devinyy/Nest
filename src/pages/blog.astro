---
import StickyNav from "../components/sticky_nav.astro";
import CategoryIcon from "../components/category_icon.astro";
import ArticlesListBlog from "../components/articles_list_blog.astro";
import timeline from "../data/blog_timeline";
import type { TimelineGroup, TimelineItem } from "../data/blog_timeline";
import { categories } from "../data/blog_category";
import { hotTags } from "../data/blog_category";
import type { BlogCategory } from "../data/blog_category";
const blogTimeline: TimelineGroup[] = timeline;
const timelineCount = blogTimeline.reduce((sum, g) => sum + g.items.length, 0);
import { categoryArticles } from "../data/articles_list";
import type { ArticleItem } from "../data/articles_list";
const currentYear = new Date().getFullYear();

// è§£ææ—¶é—´çº¿æ¡ç›®çš„æ—¥æœŸï¼šæ”¯æŒå®Œæ•´æ—¥æœŸã€ä»¥åŠä¸å«å¹´ä»½çš„ MM-DD ç­‰æ ¼å¼
function parseTimelineDate(t: string | undefined, year: number): Date | null {
  const s = String(t || '').trim();
  if (!s) return null;
  // å°è¯•ç›´æ¥è§£æ
  const d1 = new Date(year + '-' + s);
  if (!isNaN(d1.getTime())) return d1;
  // æ ‡å‡†åŒ–åˆ†éš”ç¬¦
  const norm = s.replace(/[./]/g, '-');
  // å¤„ç† MM-DD / M-D
  const mmdd = norm.match(/^\d{1,2}-\d{1,2}$/);
  if (mmdd) {
    const [m, d] = norm.split('-');
    const mm = m.padStart(2, '0');
    const dd = d.padStart(2, '0');
    const composed = `${year}-${mm}-${dd}`;
    const d2 = new Date(composed);
    if (!isNaN(d2.getTime())) return d2;
  }
  // å…œåº•ï¼šæå–è¿ç»­æ•°å­—å°è¯• YYYYMMDD
  const digits = norm.replace(/[^0-9]/g, '');
  if (digits.length >= 8) {
    const y = digits.slice(0, 4);
    const m = digits.slice(4, 6);
    const d = digits.slice(6, 8);
    const composed = `${y}-${m}-${d}`;
    const d3 = new Date(composed);
    if (!isNaN(d3.getTime())) return d3;
  }
  return null;
}

// åˆ¤æ–­æ—¥æœŸæ˜¯å¦åœ¨æœ€è¿‘ N ä¸ªæœˆå†…ï¼ˆé€šè¿‡ç»™æ¡ç›®æ—¥æœŸ +N ä¸ªæœˆä¸å½“å‰æ—¶é—´æ¯”è¾ƒï¼Œé¿å…ä¸åŒæœˆé•¿åº¦è¯¯å·®ï¼‰
function isWithinLastMonths(dt: Date, months: number): boolean {
  const end = new Date(dt.getTime());
  end.setMonth(end.getMonth() + months);
  end.setHours(23, 59, 59, 999);
  const now = new Date();
  return end >= now;
}

// ä¸ºæµè§ˆå™¨ window å¢åŠ ç±»å‹å£°æ˜ï¼Œæä¾› __categoryArticles__ æŒ‚è½½ç‚¹
declare global {
  interface Window {
    __categoryArticles__: Record<string, ArticleItem[]>;
  }
}

// ä½¿ç”¨ CategoryIcon ç»„ä»¶æ¸²æŸ“ SVG å›¾æ ‡ï¼ˆä¸ä½¿ç”¨ emojiï¼‰
---

<!doctype html>
<html lang="zh-CN" data-theme="black">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Devin's Nest</title>
    <meta name="description" content="è®°å½•æŠ€æœ¯/ç”Ÿæ´»/æ—…è¡Œ/æ‘„å½±ç­‰åšå®¢æ–‡ç« " />
    <link
      rel="preload"
      href="/fonts/MaoKenZhuYuanTi.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link rel="shortcut icon" href="/favicons/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16x16.png"
    />
    <link rel="manifest" href="/favicons/site.webmanifest" />
    <style>
      @font-face {
        font-family: "MaokenZhuyuanTi";
        src: url(/fonts/MaoKenZhuYuanTi.ttf);
        font-display: swap;
      }
      body {
        font-family: "MaokenZhuyuanTi";
      }
      /* æ—¶é—´çº¿ï¼šå·¦ä¾§ç«–çº¿ä¸èŠ‚ç‚¹æ ·å¼ */
      .timeline {
        position: relative;
        padding-left: 1.25rem; /* 20px */
        border-left: 2px solid rgba(255,255,255,0.08);
      }
      /* ä»Šå¹´ï¼šå·¦ä¾§ç«–çº¿ç»¿è‰² */
      .timeline-current {
        border-left-color: rgb(16 185 129); /* emerald-500 */
      }
      .timeline-item {
        position: relative;
        padding-left: 1rem; /* 16px */
        margin-bottom: 0.75rem; /* 12px */
      }
      .timeline-item::before {
        content: "";
        position: absolute;
        left: -0.39rem;
        top: 0.5rem;
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 9999px;
        /* é»˜è®¤ï¼šç°è‰²è¡¨ç¤ºè¿‡å» */
        background-color: rgb(156 163 175); /* gray-400 */
        box-shadow: 0 0 0 3px rgba(156,163,175,0.25);
      }
      /* å½“å‰å¹´ä»½ï¼šç»¿è‰²ç‚¹è¡¨ç¤ºç°åœ¨ */
      .timeline-item.is-current-year::before {
        background-color: rgb(16 185 129); /* emerald-500 */
        box-shadow: 0 0 0 3px rgba(16,185,129,0.25);
      }
    </style>
  </head>
  <body class="bg-base-100">
    <StickyNav showImmediately={true} />

    <main class="max-w-screen-2xl pt-20 mx-auto px-3 xs:px-5 lg:px-10 py-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- å·¦ä¾§ï¼šæ—¶é—´çº¿åˆ—è¡¨ -->
        <section class="lg:col-span-2">
          <div id="timeline-view" class="card rounded-2xl shadow-xl bg-white/5 backdrop-blur-md border border-white/5">
            <div class="card-body">
              <h1 class="text-2xl md:text-3xl font-bold mb-2">åšå®¢æ—¶é—´çº¿</h1>
              <p class="text-gray-400 mb-4">è®°å½•é‚£äº›è®©äººå¿ƒåŠ¨çš„ç¬é—´ä¸æ€è€ƒ</p>

              {blogTimeline.map((group: TimelineGroup) => (
                <div class="mb-6" data-year-group>
                  <h2 class={`text-xl md:text-2xl font-semibold ${group.year === currentYear ? 'text-emerald-400' : 'text-gray-300'} mb-2`}>{group.year} å¹´</h2>
                  <div class={`timeline ${group.year === currentYear ? 'timeline-current' : ''}`}>
                    {group.items.map((it: TimelineItem) => {
                      const dt = parseTimelineDate(it.time, group.year);
                      const isRecentSixMonths = !!dt && group.year === currentYear && isWithinLastMonths(dt, 6);
                      return (
                        <div class={`timeline-item ${isRecentSixMonths ? 'is-current-year' : ''}`} data-category={it.category ?? ""} data-tags={(it.tags ?? []).join(",")}>
                          <div class="flex items-start gap-3 text-sm md:text-base">
                            <span class="text-gray-400 w-16 shrink-0">{it.time}</span>
                            <a href={it.url ?? "#"} class="hover:text-white text-gray-200">{it.title}</a>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              ))}
            </div>
          </div>

          <!-- åˆ†ç±»æ–‡ç« åˆ—è¡¨è§†å›¾ï¼ˆåˆå§‹éšè—ï¼‰ -->
          <div id="category-list-view" class="card rounded-2xl shadow-xl bg-white/5 backdrop-blur-md border border-white/5 hidden">
            <div class="card-body">
              <div class="flex items-center justify-between mb-2">
                <h1 class="text-2xl md:text-3xl font-bold"><span id="category-list-title">åˆ†ç±»æ–‡ç« </span></h1>
                <div class="flex items-center gap-2">
                  <button id="sort-latest" class="btn btn-sm rounded-xl bg-emerald-500 hover:bg-emerald-400 text-black border-emerald-500">æœ€æ–°</button>
                  <button id="sort-hot" class="btn btn-sm rounded-xl btn-outline text-gray-200">æœ€çƒ­</button>
                  <button id="back-to-timeline" class="btn btn-sm btn-outline">è¿”å›æ—¶é—´çº¿</button>
                </div>
              </div>
              <div id="category-list-container" class="grid grid-cols-1 gap-2"></div>
              <div id="category-pager" class="mt-2 flex items-center justify-between">
                <div id="pager-info" class="text-xs text-gray-400">ç¬¬ 1 / 1 é¡µ</div>
                <div class="join">
                  <button class="btn btn-xs join-item" data-page-prev>ä¸Šä¸€é¡µ</button>
                  <button class="btn btn-xs join-item" data-page-next>ä¸‹ä¸€é¡µ</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- å³ä¾§ï¼šåˆ†ç±» & çƒ­é—¨æ ‡ç­¾ -->
        <aside class="lg:col-span-1 flex flex-col gap-6">
          <!-- åˆ†ç±» -->
          <div class="card rounded-2xl shadow-xl bg-white/5 backdrop-blur-md border border-white/5">
            <div class="card-body">
              <h3 class="text-lg md:text-xl font-bold">åˆ†ç±»</h3>
              <div class="divider my-2"></div>
              <ul class="space-y-2" id="categoryList">
                {categories.map((c: BlogCategory, idx) => (
                  <li>
                    <a href={c.href ?? "#"} data-category-link={c.name} class="block px-3 py-2 rounded-lg hover:bg-base-300">
                      <div class="flex items-center justify-between">
                        <span class="font-medium text-gray-200" data-category-text>{c.name}</span>
                        <span data-category-icon class="w-10 h-10 rounded-full flex items-center justify-center text-gray-400 bg-base-300">
                          <CategoryIcon name={c.icon} class="w-5 h-5" />
                        </span>
                      </div>
                      {c.name === 'æ—¶é—´çº¿' ? (
                        <p class="text-xs text-gray-500 mt-1">{timelineCount}æ¡è®°å½•</p>
                      ) : (
                        c.count !== undefined ? (
                          <p class="text-xs text-gray-500 mt-1">{c.count}ç¯‡æ–‡ç« </p>
                        ) : null
                      )}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </div>

          <!-- çƒ­é—¨æ ‡ç­¾ -->
          <div class="card rounded-2xl shadow-xl bg-white/5 backdrop-blur-md border border-white/5">
            <div class="card-body">
              <h3 class="text-lg md:text-xl font-bold mb-2">çƒ­é—¨æ ‡ç­¾</h3>
              <div class="flex flex-wrap gap-2" id="tagList">
                {hotTags.map((t) => (
                  <a href="#" data-tag-link={t} class="px-3 py-1 rounded-full bg-base-300 text-gray-200 hover:bg-base-200">{t}</a>
                ))}
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // è§†å›¾çŠ¶æ€
        let activeCategory = null; // å½“å‰é€‰ä¸­çš„åˆ†ç±»åç§°
        let activeTag = null; // å½“å‰é€‰ä¸­çš„æ ‡ç­¾åç§°
        let currentPage = 1;
        const pageSize = 10;
        let sortMode = 'latest'; // 'latest' | 'hot'

        const timelineView = document.getElementById('timeline-view');
        const listView = document.getElementById('category-list-view');
        const listTitle = document.getElementById('category-list-title');
        const listContainer = document.getElementById('category-list-container');
        const pager = document.getElementById('category-pager');
        const pagerInfo = document.getElementById('pager-info');
        const backBtn = document.getElementById('back-to-timeline');
        const sortLatestBtn = document.getElementById('sort-latest');
        const sortHotBtn = document.getElementById('sort-hot');

        function updateSortButtons() {
          if (sortLatestBtn instanceof HTMLElement && sortHotBtn instanceof HTMLElement) {
            const latestActive = sortMode === 'latest';
            sortLatestBtn.classList.toggle('bg-emerald-500', latestActive);
            sortLatestBtn.classList.toggle('hover:bg-emerald-400', latestActive);
            sortLatestBtn.classList.toggle('text-black', latestActive);
            sortLatestBtn.classList.toggle('border-emerald-500', latestActive);
            sortLatestBtn.classList.toggle('btn-outline', !latestActive);
            sortLatestBtn.classList.toggle('text-gray-200', !latestActive);

            const hotActive = sortMode === 'hot';
            sortHotBtn.classList.toggle('btn-outline', !hotActive);
            sortHotBtn.classList.toggle('bg-emerald-500', hotActive);
            sortHotBtn.classList.toggle('hover:bg-emerald-400', hotActive);
            sortHotBtn.classList.toggle('text-black', hotActive);
            sortHotBtn.classList.toggle('border-emerald-500', hotActive);
            sortHotBtn.classList.toggle('text-gray-200', !hotActive);
          }
        }

        function parseViews(v) {
          if (typeof v === 'number') return v;
          const s = String(v || '').trim().toLowerCase();
          if (!s) return 0;
          // æ”¯æŒ k / ä¸‡ ç­‰ç®€å†™
          const num = parseFloat(s.replace(/[^0-9.]/g, ''));
          if (isNaN(num)) return 0;
          if (s.includes('k')) return Math.round(num * 1000);
          if (s.includes('ä¸‡')) return Math.round(num * 10000);
          return Math.round(num);
        }

        function parseTime(t) {
          const s = String(t || '').trim();
          const ts = Date.parse(s);
          if (!isNaN(ts)) return ts;
          // å…œåº•ï¼šæå–æ•°å­—ä½œä¸ºæ’åºä¾æ®ï¼ˆå¦‚ 2024/10/05 -> 20241005ï¼‰
          const digits = s.replace(/[^0-9]/g, '');
          return digits ? parseInt(digits, 10) : 0;
        }

        function showTimelineView() {
          if (timelineView instanceof HTMLElement) timelineView.classList.remove('hidden');
          if (listView instanceof HTMLElement) listView.classList.add('hidden');
        }
        function showListView() {
          if (timelineView instanceof HTMLElement) timelineView.classList.add('hidden');
          if (listView instanceof HTMLElement) listView.classList.remove('hidden');
        }

        // å½“å±•ç¤ºæ—¶é—´çº¿è§†å›¾æ—¶ï¼Œå°†â€œæ—¶é—´çº¿â€åˆ†ç±»é«˜äº®ä¸ºç»¿è‰²
        function setTimelineActiveCategory() {
          activeCategory = 'æ—¶é—´çº¿';
          document.querySelectorAll('[data-category-link]').forEach((el) => {
            const isActive = el.getAttribute('data-category-link') === activeCategory;
            const text = el.querySelector('[data-category-text]');
            if (text) {
              text.classList.toggle('text-emerald-400', !!isActive);
              text.classList.toggle('text-gray-200', !isActive);
            }
            const icon = el.querySelector('[data-category-icon]');
            if (icon) {
              icon.classList.toggle('text-emerald-400', !!isActive);
              icon.classList.toggle('bg-emerald-500/25', !!isActive);
              icon.classList.toggle('text-gray-400', !isActive);
              icon.classList.toggle('bg-base-300', !isActive);
            }
          });
        }

        function normalizeTag(tag) {
          return String(tag || '').trim();
        }

        function getAllArticles() {
          const data = window.__categoryArticles__ || {};
          const all = [];
          Object.keys(data).forEach((k) => {
            const arr = data[k] || [];
            arr.forEach((it) => all.push(it));
          });
          return all;
        }

        function getFilteredArticles() {
          const data = window.__categoryArticles__ || {};
          const tag = normalizeTag(activeTag);
          const hasCategory = !!activeCategory && activeCategory !== 'æ—¶é—´çº¿';

          // åŒæ—¶æ”¯æŒï¼š1åˆ†ç±» + 1æ ‡ç­¾ï¼ˆäº¤é›†ï¼‰
          if (hasCategory && tag) {
            const base = data[activeCategory] || [];
            return base.filter((a) => (a.tags || []).includes(tag));
          }
          // ä»…æ ‡ç­¾
          if (tag) {
            return getAllArticles().filter((a) => (a.tags || []).includes(tag));
          }
          // ä»…åˆ†ç±»ï¼ˆæ’é™¤â€œæ—¶é—´çº¿â€ç‰¹æ®Šé¡¹ï¼‰
          if (hasCategory) {
            return data[activeCategory] || [];
          }
          return [];
        }

        function renderList() {
          const items = getFilteredArticles();
          // æ’åº
          const sorted = [...items].sort((a, b) => {
            if (sortMode === 'hot') {
              return parseViews(b.views) - parseViews(a.views);
            }
            // latestï¼šæ—¶é—´å€’åº
            return parseTime(b.time) - parseTime(a.time);
          });
          const total = sorted.length;
          const pages = Math.max(1, Math.ceil(total / pageSize));
          if (currentPage > pages) currentPage = pages;
          const start = (currentPage - 1) * pageSize;
          const slice = sorted.slice(start, start + pageSize);

          if (listTitle) {
            const catText = activeCategory && activeCategory !== 'æ—¶é—´çº¿' ? `${activeCategory}` : '';
            const tagText = activeTag ? `${activeTag}` : '';
            const joinText = [catText, tagText].filter(Boolean).join(' Â· ');
            listTitle.textContent = joinText || 'åˆ†ç±»æ–‡ç« ';
          }

          if (listContainer) {
            const html = slice.map((a) => {
              const coverHtml = a.cover
                ? `<figure class="w-full h-40 md:h-52"><img src="${a.cover}" alt="${a.title}" class="w-full h-full object-cover object-center"/></figure>`
                : `<div class=\"w-full h-40 md:h-52 bg-base-300 flex items-center justify-center\"><span class=\"px-3 py-2 rounded-md bg-emerald-600/20 text-emerald-400 text-sm font-semibold\">é…å›¾</span></div>`;
              const viewsHtml = a.views ? `<span class=\"inline-flex items-center gap-2\"><span aria-hidden=\"true\">ğŸ‘ï¸</span>${a.views}</span>` : '';
              const tagsHtml = Array.isArray(a.tags) && a.tags.length
                ? `<div class=\"mt-2 flex flex-wrap gap-2\">${a.tags.map((t) => `<span class=\"inline-flex items-center rounded-full bg-base-300 px-2.5 py-0.5 text-xs text-gray-300\">${t}</span>`).join('')}</div>`
                : '';
              return `
                <a href="${a.url}" target="_blank" class="group relative card rounded-2xl bg-neutral border border-white/5 hover:bg-base-300 overflow-hidden w-full">
                  <span class="pointer-events-none absolute left-3 top-4 bottom-4 w-[3px] bg-emerald-500/80 rounded-full" aria-hidden="true"></span>
                  ${coverHtml}
                  <div class="card-body">
                    <div class="flex flex-wrap justify-between items-center gap-3 text-sm text-gray-400">
                      <span class="inline-flex items-center gap-2"><span aria-hidden="true">ğŸ“…</span>${a.time || ''}</span>
                      ${viewsHtml}
                    </div>
                    <h3 class="text-base md:text-xl font-bold mt-2 text-white group-hover:text-emerald-400">${a.title}</h3>
                    ${a.subdesc ? `<p class="mt-2 text-sm md:text-base text-gray-300 line-clamp-2">${a.subdesc}</p>` : ''}
                    ${tagsHtml}
                    <div class="card-actions justify-end">
                      <button class="btn btn-sm rounded-xl border border-white/5 bg-base-300 hover:bg-base-200 text-gray-200">è¯¦æƒ…</button>
                    </div>
                  </div>
                </a>
              `;
            }).join('');
            listContainer.innerHTML = html;
          }

          if (pagerInfo) {
            pagerInfo.textContent = `ç¬¬ ${currentPage} / ${Math.max(1, pages)} é¡µ`;
          }

          // æ§åˆ¶åˆ†é¡µæŒ‰é’®ç¦ç”¨
          if (pager instanceof HTMLElement) {
            const prevBtn = pager.querySelector('[data-page-prev]');
            const nextBtn = pager.querySelector('[data-page-next]');
            if (prevBtn instanceof HTMLElement) prevBtn.toggleAttribute('disabled', currentPage <= 1);
            if (nextBtn instanceof HTMLElement) nextBtn.toggleAttribute('disabled', currentPage >= pages);
          }
        }

        // åˆ†ç±»ç‚¹å‡»ï¼šåˆ—è¡¨/æ—¶é—´çº¿åˆ‡æ¢
        document.querySelectorAll('[data-category-link]').forEach((a) => {
          a.addEventListener('click', (e) => {
            e.preventDefault();
            const name = a.getAttribute('data-category-link');
            const wasSelected = (activeCategory === name);
            activeCategory = wasSelected ? null : name;

            // æ›´æ–°é€‰ä¸­æ€æ ·å¼
            document.querySelectorAll('[data-category-link]').forEach((el) => {
              const isActive = el.getAttribute('data-category-link') === activeCategory;
              const text = el.querySelector('[data-category-text]');
              if (text) {
                text.classList.toggle('text-emerald-400', !!isActive);
                text.classList.toggle('text-gray-200', !isActive);
              }
              const icon = el.querySelector('[data-category-icon]');
              if (icon) {
                icon.classList.toggle('text-emerald-400', !!isActive);
                icon.classList.toggle('bg-emerald-500/25', !!isActive);
                icon.classList.toggle('text-gray-400', !isActive);
                icon.classList.toggle('bg-base-300', !isActive);
              }
            });

            // ç‚¹å‡»â€œæ—¶é—´çº¿â€ -> å›åˆ°æ—¶é—´çº¿è§†å›¾å¹¶é«˜äº®â€œæ—¶é—´çº¿â€åˆ†ç±»ï¼ŒåŒæ—¶å–æ¶ˆå·²é€‰æ ‡ç­¾
            if (name === 'æ—¶é—´çº¿') {
              activeTag = null;
              document.querySelectorAll('[data-tag-link]').forEach((el) => {
                el.classList.remove('bg-emerald-500/25');
                el.classList.remove('text-emerald-400');
                el.classList.add('bg-base-300');
                el.classList.add('text-gray-200');
              });
              showTimelineView();
              setTimelineActiveCategory();
              return;
            }

            // äºŒæ¬¡ç‚¹å‡»åŒä¸€åˆ†ç±» -> è¿”å›æ—¶é—´çº¿å¹¶å–æ¶ˆå·²é€‰æ ‡ç­¾
            if (wasSelected) {
              activeTag = null;
              document.querySelectorAll('[data-tag-link]').forEach((el) => {
                el.classList.remove('bg-emerald-500/25');
                el.classList.remove('text-emerald-400');
                el.classList.add('bg-base-300');
                el.classList.add('text-gray-200');
              });
              showTimelineView();
              setTimelineActiveCategory();
              return;
            }

            // è¿›å…¥åˆ—è¡¨è§†å›¾ï¼ˆæŒ‰åˆ†ç±»ï¼‰ï¼Œä¿ç•™å·²é€‰æ‹©çš„æ ‡ç­¾ï¼ˆå¦‚æœæœ‰ï¼‰
            currentPage = 1;
            renderList();
            showListView();
          });
        });

        // æ ‡ç­¾ç‚¹å‡»ï¼šè¿›å…¥åˆ—è¡¨è§†å›¾ï¼ˆæŒ‰æ ‡ç­¾ï¼‰
        document.querySelectorAll('[data-tag-link]').forEach((a) => {
          a.addEventListener('click', (e) => {
            e.preventDefault();
            const name = a.getAttribute('data-tag-link');
            const wasSelected = (activeTag === name);
            activeTag = wasSelected ? null : name;

            // æ›´æ–°é€‰ä¸­æ€æ ·å¼ï¼ˆé€‰ä¸­æ—¶æ–‡å­—å˜ç»¿ï¼‰
            document.querySelectorAll('[data-tag-link]').forEach((el) => {
              const isActive = el.getAttribute('data-tag-link') === activeTag;
              el.classList.toggle('bg-emerald-500/25', !!isActive);
              el.classList.toggle('bg-base-300', !isActive);
              el.classList.toggle('text-emerald-400', !!isActive);
              el.classList.toggle('text-gray-200', !isActive);
            });

            if (wasSelected) {
              // æ ‡ç­¾å–æ¶ˆï¼šè‹¥ä»æœ‰åˆ†ç±»é€‰ä¸­ï¼Œåˆ™æ˜¾ç¤ºåˆ†ç±»åˆ—è¡¨ï¼›å¦åˆ™å›åˆ°æ—¶é—´çº¿
              if (activeCategory && activeCategory !== 'æ—¶é—´çº¿') {
                currentPage = 1;
                renderList();
                showListView();
              } else {
                showTimelineView();
                setTimelineActiveCategory();
              }
              return;
            }

            // è‹¥å½“å‰åˆ†ç±»ä¸ºâ€œæ—¶é—´çº¿â€ï¼Œé€‰æ‹©æ ‡ç­¾æ—¶æ”¹ä¸ºåˆ—è¡¨è§†å›¾ï¼ˆæ¸…ç©ºåˆ†ç±»ï¼‰
            if (activeCategory === 'æ—¶é—´çº¿') {
              activeCategory = null;
              document.querySelectorAll('[data-category-link]').forEach((el) => {
                const text = el.querySelector('[data-category-text]');
                if (text) {
                  text.classList.remove('text-emerald-400');
                  text.classList.add('text-gray-200');
                }
                const icon = el.querySelector('[data-category-icon]');
                if (icon) {
                  icon.classList.remove('text-emerald-400', 'bg-emerald-500/25');
                  icon.classList.add('text-gray-400', 'bg-base-300');
                }
              });
            }

            currentPage = 1;
            renderList();
            showListView();
          });
        });

        // æ’åºæŒ‰é’®
        sortLatestBtn && sortLatestBtn.addEventListener('click', (e) => {
          e.preventDefault();
          sortMode = 'latest';
          updateSortButtons();
          currentPage = 1;
          renderList();
        });
        sortHotBtn && sortHotBtn.addEventListener('click', (e) => {
          e.preventDefault();
          sortMode = 'hot';
          updateSortButtons();
          currentPage = 1;
          renderList();
        });

        // åˆ†é¡µæŒ‰é’®
        if (pager instanceof HTMLElement) {
          const prevBtn = pager.querySelector('[data-page-prev]');
          const nextBtn = pager.querySelector('[data-page-next]');
          prevBtn && prevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentPage > 1) {
              currentPage -= 1;
              renderList();
            }
          });
          nextBtn && nextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            currentPage += 1;
            renderList();
          });
        }

        // è¿”å›æ—¶é—´çº¿
        backBtn && backBtn.addEventListener('click', (e) => {
          e.preventDefault();
          activeCategory = null;
          activeTag = null;
          currentPage = 1;
          // æ¸…ç©ºæ ·å¼
          document.querySelectorAll('[data-category-link]').forEach((el) => {
            const text = el.querySelector('[data-category-text]');
            if (text) {
              text.classList.remove('text-emerald-400');
              text.classList.add('text-gray-200');
            }
            const icon = el.querySelector('[data-category-icon]');
            if (icon) {
              icon.classList.remove('text-emerald-400', 'bg-emerald-500/25');
              icon.classList.add('text-gray-400', 'bg-base-300');
            }
          });
          document.querySelectorAll('[data-tag-link]').forEach((el) => {
            el.classList.remove('bg-emerald-500/25');
            el.classList.remove('text-emerald-400');
            el.classList.add('bg-base-300');
            el.classList.add('text-gray-200');
          });
          showTimelineView();
          // æ—¶é—´çº¿è§†å›¾ï¼šé«˜äº®â€œæ—¶é—´çº¿â€åˆ†ç±»
          setTimelineActiveCategory();
        });

        // æ³¨å…¥åˆ†ç±»æ–‡ç« æ•°æ®ï¼ˆä¾›å‰ç«¯è„šæœ¬ä½¿ç”¨ï¼‰
        window.__categoryArticles__ = /** @type {Record<string, any[]>} */ ({});
        try {
          // é€šè¿‡ inline JSON æ³¨å…¥
          const dataScript = document.getElementById('__category_articles_data');
          if (dataScript) {
            const parsed = JSON.parse(dataScript.textContent || '{}');
            window.__categoryArticles__ = parsed || {};
          }
        } catch (_) {}

        // åˆå§‹ï¼šæ—¶é—´çº¿è§†å›¾ï¼Œå¹¶é«˜äº®â€œæ—¶é—´çº¿â€åˆ†ç±»
        showTimelineView();
        setTimelineActiveCategory();
        updateSortButtons();
      });
    </script>

    <!-- æ³¨å…¥åˆ†ç±»æ–‡ç« æ•°æ®ï¼ˆJSONï¼‰ -->
    <script id="__category_articles_data" type="application/json">
      {JSON.stringify(categoryArticles)}
    </script>
  </body>
</html>