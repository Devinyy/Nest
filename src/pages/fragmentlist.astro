---
import StickyNav from "../components/sticky_nav.astro";
import timeline from "../data/fragment_timeline";
import type { TimelineGroup } from "../data/fragment_timeline";
import { dailyArticles } from "../data/daily_articles";

const fragmentTimeline: TimelineGroup[] = timeline;
const validIds = new Set(dailyArticles.map(a => a.id));

// 简单的辅助函数，用于增强展示效果
function getTimelineDotColor(index: number) {
  const colors = [
    "bg-emerald-500",
    "bg-blue-500",
    "bg-purple-500",
    "bg-rose-500",
    "bg-amber-500",
  ];
  return colors[index % colors.length];
}
---

<!doctype html>
<html lang="zh-CN" data-theme="black">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fragment List - Devin's Nest</title>
    <meta name="description" content="日常碎片，记录生活点滴" />
    <link
      rel="preload"
      href="/fonts/MaoKenZhuYuanTi.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link rel="shortcut icon" href="/favicons/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16x16.png"
    />
    <link rel="manifest" href="/favicons/site.webmanifest" />
    <style>
      @font-face {
        font-family: "MaokenZhuyuanTi";
        src: url(/fonts/MaoKenZhuYuanTi.ttf);
        font-display: swap;
      }
      body {
        cursor: url(/icons/cursor.ico), auto;
        font-family: "MaokenZhuyuanTi";
      }
      
      /* 时间线连接线 */
      .timeline-connector {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 15px; /* Adjust to align with dot center */
        width: 2px;
        background: linear-gradient(to bottom, rgba(255,255,255,0.05), rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05));
      }
      
      .fragment-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .fragment-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
      }
    </style>
  </head>
  <body class="bg-base-100 min-h-screen selection:bg-emerald-500/30">
    <StickyNav showImmediately={true} />

    <main class="max-w-3xl pt-28 mx-auto px-4 sm:px-6 lg:px-8 py-12 mb-20">
        <!-- 页面头部 -->
        <header class="mb-16 text-center animate-fade-in-down">
            <h1 class="text-4xl md:text-5xl font-bold mb-6 tracking-tight">
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 via-teal-400 to-cyan-400">
                    日常碎片
                </span>
            </h1>
            <p class="text-gray-400 text-lg max-w-lg mx-auto leading-relaxed">
                收集散落在时间缝隙里的微光，记录那些稍纵即逝的瞬间与思考。
            </p>
        </header>

        <div class="relative space-y-16">
            {fragmentTimeline.map((group) => (
                <div class="relative group-year">
                    <!-- 年份标记 -->
                    <div class="flex items-center gap-4 mb-8">
                        <div class="text-5xl font-bold text-white/5 select-none absolute -left-4 -top-6 pointer-events-none z-0 scale-150 origin-bottom-left transition-colors duration-500 group-year-hover:text-white/10">
                            {group.year}
                        </div>
                        <h2 class="text-2xl font-bold text-emerald-400 relative z-10 pl-2 border-l-4 border-emerald-500/50">
                            {group.year}
                        </h2>
                    </div>
                    
                    <div class="relative pl-4 md:pl-8 space-y-8">
                        <!-- 连接线 -->
                        <div class="timeline-connector"></div>

                        {group.items.map((item, index) => {
                            const hasContent = validIds.has(item.blogId);
                            return (
                            <div class="relative flex gap-6 items-start group">
                                <!-- 时间点装饰 -->
                                <div class={`absolute left-[11px] top-2 w-2 h-2 rounded-full ${getTimelineDotColor(index)} ring-4 ring-base-100 z-10 group-hover:scale-125 transition-transform duration-300`}></div>
                                
                                <!-- 内容卡片 -->
                                <a href={hasContent ? `/blog/daily?id=${item.blogId}` : '/404'} class="flex-1 fragment-card bg-white/5 backdrop-blur-md border border-white/5 rounded-2xl p-5 md:p-6 ml-6 w-full hover:border-emerald-500/20 hover:bg-white/10 cursor-pointer">
                                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3">
                                        <h3 class="text-xl font-semibold text-gray-100 group-hover:text-emerald-300 transition-colors">
                                            {item.title}
                                        </h3>
                                        <time class="text-sm font-mono text-gray-500 shrink-0 bg-black/20 px-2 py-1 rounded">
                                            {item.time}
                                        </time>
                                    </div>
                                    
                                    {item.content && (
                                        <p class="text-gray-400 leading-relaxed text-sm md:text-base border-t border-white/5 pt-3 mt-1">
                                            {item.content}
                                        </p>
                                    )}
                                </a>
                            </div>
                        )})}
                    </div>
                </div>
            ))}
        </div>
        
        <!-- 底部装饰 -->
        <div class="mt-20 text-center">
             <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-white/5 text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM12.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM18.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                </svg>
             </div>
             <p class="mt-4 text-xs text-gray-600">未完待续...</p>
        </div>
    </main>
  </body>
</html>
