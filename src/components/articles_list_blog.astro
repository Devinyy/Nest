---
import articlesList from "../data/articles_list";
---

<div
  class="card max-lg:card-compact rounded-2xl shadow-md bg-neutral w-full min-h-[3rem] mb-4"
>
  <div class="card-body p-4 sm:p-5">
    {
      articlesList.map((articles, index) => (
        <div
          class={`tab-content ${index === 0 ? "block" : "hidden"}`}
          data-tab-index={index}
          data-page-size="10"
        >
          <div class="grid grid-cols-1 gap-2">
            {articles.articles.map((article) => (
              <a
                class="article-item group relative card rounded-2xl bg-neutral border border-white/10 hover:bg-base-300 overflow-hidden w-full"
                href={article.url}
                target="_blank"
              >
                <span class="pointer-events-none absolute left-3 top-3 bottom-3 w-[2px] bg-emerald-500/80 rounded-full" aria-hidden="true"></span>

                <div class="card-body p-4 sm:p-5">
                  <div class="flex items-start gap-3">
                    <div class="w-20 h-20 md:w-24 md:h-24 shrink-0">
                      {article.cover ? (
                        <img src={article.cover} alt={article.title} class="w-full h-full object-cover object-center rounded-md" />
                      ) : (
                        <div class="w-full h-full bg-base-300 flex items-center justify-center rounded-md">
                          <span class="px-2 py-1 rounded-md bg-emerald-600/20 text-emerald-400 text-xs font-semibold">é…å›¾</span>
                        </div>
                      )}
                    </div>

                    <div class="flex-1">
                      <h3 class="text-sm md:text-base font-bold text-white group-hover:text-emerald-400">{article.title}</h3>
                      {article.subdesc && (
                        <p class="mt-1 text-xs md:text-sm text-gray-300 line-clamp-2">{article.subdesc}</p>
                      )}

                      <div class="mt-2 flex flex-wrap items-center gap-2 text-xs text-gray-400">
                        <span class="inline-flex items-center gap-1">
                          <span aria-hidden="true">ğŸ“…</span>
                          {article.time}
                        </span>
                        {article.views && (
                          <span class="inline-flex items-center gap-1">
                            <span aria-hidden="true">ğŸ‘ï¸</span>
                            {article.views}
                          </span>
                        )}
                      </div>

                      {article.tags && article.tags.length > 0 && (
                        <div class="mt-2 flex flex-wrap gap-2">
                          {article.tags.map((t) => (
                            <span class="inline-flex items-center rounded-full bg-base-300 px-2.5 py-0.5 text-xs text-gray-300">{t}</span>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </a>
            ))}
          </div>

          <div class="pt-1" />

          <div class="card-actions justify-between items-center">
            <div class="text-xs text-gray-400">
              ç¬¬ <span class="pager-current">1</span> / <span class="pager-total">1</span> é¡µ
            </div>
            <div class="join">
              <button class="btn btn-xs join-item pager-prev" type="button">ä¸Šä¸€é¡µ</button>
              <button class="btn btn-xs join-item pager-next" type="button">ä¸‹ä¸€é¡µ</button>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tabs = document.querySelectorAll(".tab");
    const contents = document.querySelectorAll(".tab-content");

    function setActiveTab(index: number) {
      tabs.forEach((tab, i) => {
        if (i === index) {
          tab.classList.add("tab-active");
        } else {
          tab.classList.remove("tab-active");
        }
      });

      contents.forEach((content, i) => {
        if (i === index) {
          content.classList.remove("hidden");
          content.classList.add("block");
        } else {
          content.classList.add("hidden");
          content.classList.remove("block");
        }
      });
    }

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const index = parseInt(tab.getAttribute("data-tab-index"));
        setActiveTab(index);
      });
    });

    // åˆå§‹åŒ–æ¯ä¸ªå†…å®¹é¢æ¿çš„åˆ†é¡µ
    function initPaginationForContent(tc: HTMLElement) {
      const items = tc.querySelectorAll<HTMLElement>(".article-item");
      const pageSizeAttr = tc.getAttribute("data-page-size");
      const pageSize = pageSizeAttr ? parseInt(pageSizeAttr, 10) : 10;
      const totalPages = Math.max(1, Math.ceil(items.length / pageSize));
      tc.dataset.totalPages = String(totalPages);
      tc.dataset.currentPage = "1";

      const currentSpan = tc.querySelector<HTMLElement>(".pager-current");
      const totalSpan = tc.querySelector<HTMLElement>(".pager-total");
      const prevBtn = tc.querySelector<HTMLButtonElement>(".pager-prev");
      const nextBtn = tc.querySelector<HTMLButtonElement>(".pager-next");

      function renderPage(page: number) {
        const start = (page - 1) * pageSize;
        const end = start + pageSize;
        items.forEach((el, idx) => {
          el.style.display = idx >= start && idx < end ? "" : "none";
        });
        tc.dataset.currentPage = String(page);
        if (currentSpan) currentSpan.textContent = String(page);
        if (totalSpan) totalSpan.textContent = String(totalPages);
        if (prevBtn) prevBtn.disabled = page <= 1;
        if (nextBtn) nextBtn.disabled = page >= totalPages;
      }

      // åˆå§‹æ¸²æŸ“ç¬¬ä¸€é¡µ
      renderPage(1);

      // ç»‘å®šäº‹ä»¶
      if (prevBtn) {
        prevBtn.addEventListener("click", () => {
          const curr = parseInt(tc.dataset.currentPage || "1", 10);
          if (curr > 1) renderPage(curr - 1);
        });
      }
      if (nextBtn) {
        nextBtn.addEventListener("click", () => {
          const curr = parseInt(tc.dataset.currentPage || "1", 10);
          const total = parseInt(tc.dataset.totalPages || "1", 10);
          if (curr < total) renderPage(curr + 1);
        });
      }
    }

    contents.forEach((content) => {
      initPaginationForContent(content as HTMLElement);
    });

    setActiveTab(0);
  });
</script>